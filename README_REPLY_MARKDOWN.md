# 📝 訊息引用回覆 & Markdown 支援

## 新功能說明

### 1. ✉️ 訊息引用回覆

#### 使用方式
1. **滑鼠移到任意訊息上**，會出現 `↩️ 回覆` 按鈕
2. **點擊回覆按鈕**，訊息輸入框上方會顯示引用預覽
3. **輸入你的回覆內容**後發送
4. 發送的訊息會顯示引用的原訊息

#### 功能特點
- 🎯 清楚標示回覆對象
- 👁️ 引用預覽可隨時取消
- 💬 支援回覆文字、圖片、語音訊息
- 🎨 美觀的引用樣式設計

---

### 2. 📝 Markdown 支援

#### 基本語法

##### 標題
```markdown
# 大標題（H1）
## 次標題（H2）
### 小標題（H3）
```

##### 文字樣式
```markdown
**粗體文字**
*斜體文字*
~~刪除線~~
`行內程式碼`
```

##### 列表
```markdown
- 無序列表項目 1
- 無序列表項目 2

1. 有序列表項目 1
2. 有序列表項目 2
```

##### 連結與圖片
```markdown
[連結文字](https://example.com)
![圖片說明](圖片網址)
```

##### 引用
```markdown
> 這是引用文字
> 可以多行
```

##### 程式碼區塊
````markdown
```python
def hello():
    print("Hello World!")
```
````

##### 表格
```markdown
| 欄位1 | 欄位2 | 欄位3 |
|-------|-------|-------|
| 內容1 | 內容2 | 內容3 |
| 內容4 | 內容5 | 內容6 |
```

##### 分隔線
```markdown
---
```

#### 進階功能

##### 程式碼高亮
支援多種程式語言的語法高亮：

````markdown
```javascript
function greet(name) {
    console.log(`Hello, ${name}!`);
}
```

```python
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)
```

```go
func main() {
    fmt.Println("Hello, Go!")
}
```
````

---

## 🎯 使用範例

### 範例 1：技術討論
```markdown
## Bug 修復報告

**問題描述：** 登入功能失效

**解決方案：**
1. 檢查 token 過期時間
2. 更新 session 處理邏輯

**程式碼：**
\```javascript
function validateToken(token) {
    return jwt.verify(token, SECRET_KEY);
}
\```

**結果：** ✅ 已修復
```

### 範例 2：會議紀錄
```markdown
# 專案會議 2025/01/24

## 出席人員
- Alice
- Bob
- Charlie

## 討論事項
1. **專案進度檢討**
   - 前端完成 80%
   - 後端完成 60%

2. **下週目標**
   - [ ] 完成 API 整合
   - [ ] 進行功能測試

> **重要：** 下週五前需完成所有功能
```

### 範例 3：程式碼分享
````markdown
剛寫了一個快速排序的實現：

```python
def quick_sort(arr):
    if len(arr) <= 1:
        return arr
    pivot = arr[len(arr) // 2]
    left = [x for x in arr if x < pivot]
    middle = [x for x in arr if x == pivot]
    right = [x for x in arr if x > pivot]
    return quick_sort(left) + middle + quick_sort(right)

# 測試
numbers = [3, 6, 8, 10, 1, 2, 1]
print(quick_sort(numbers))
```

**時間複雜度：** O(n log n)
````

---

## 💡 實用技巧

### 技巧 1：快速格式化
- 選取文字後按 `Ctrl+B` → 粗體（瀏覽器支援）
- 使用 `>` 開頭快速建立引用
- 使用 `-` 或 `*` 開頭快速建立列表

### 技巧 2：混合使用
可以在引用回覆中使用 Markdown：

1. 點擊回覆按鈕
2. 輸入框中使用 Markdown 語法
3. 發送後會同時顯示引用和格式化內容

### 技巧 3：程式碼分享最佳實踐
- 始終指定程式語言以獲得語法高亮
- 加入註解說明關鍵邏輯
- 使用適當的縮排

### 技巧 4：表格使用
適合用於：
- 數據對比
- 功能清單
- 時間規劃

---

## 🎨 樣式預覽

### 引用訊息樣式
引用的訊息會顯示：
- 🔵 淺藍色背景
- 👤 原作者名稱（藍色）
- 💬 原訊息內容（半透明）
- 📏 左側藍色邊條

### Markdown 渲染樣式
- **標題**：有底線分隔
- **程式碼**：深色背景 + 語法高亮
- **引用**：左側邊條 + 特殊背景
- **連結**：天藍色 + 懸停底線
- **表格**：邊框線 + 標題背景

---

## 🔧 技術細節

### 使用的函式庫
- **marked.js** v11.1.1 - Markdown 解析
- **highlight.js** v11.9.0 - 程式碼語法高亮
- **atom-one-dark** 主題 - 程式碼配色

### 支援的程式語言
- JavaScript / TypeScript
- Python
- Go
- Java
- C / C++
- HTML / CSS
- SQL
- Bash / Shell
- 以及更多...

### 安全性
- ✅ 自動 HTML 轉義防止 XSS
- ✅ 安全的 Markdown 渲染
- ✅ 引用內容過濾

---

## ❓ 常見問題

### Q: Markdown 不生效怎麼辦？
A: 確保瀏覽器已載入 marked.js 和 highlight.js。重新整理頁面試試。

### Q: 可以編輯已發送的訊息嗎？
A: 目前不支援編輯，但可以使用引用回覆功能補充說明。

### Q: 支援 LaTeX 數學公式嗎？
A: 目前版本不支援，但可以使用程式碼區塊分享公式。

### Q: 如何查看 Markdown 語法？
A: 點擊工具列的「📝 Markdown」按鈕查看語法說明。

### Q: 程式碼高亮不顯示？
A: 確保使用三個反引號包裹程式碼，並指定語言名稱。

---

## 🚀 快速開始

### 第一步：測試引用回覆
1. 發送一條測試訊息
2. 滑鼠移到訊息上
3. 點擊「↩️ 回覆」
4. 輸入回覆內容並發送

### 第二步：測試 Markdown
發送以下內容測試：
```markdown
## 測試標題
這是 **粗體** 和 *斜體* 文字。

- 列表項目 1
- 列表項目 2

> 這是引用文字
```

### 第三步：測試程式碼
````markdown
分享一段程式碼：

```javascript
console.log("Hello, Markdown!");
```
````

---

## 📊 功能對比

| 功能 | 基本訊息 | Markdown 訊息 |
|------|----------|---------------|
| 純文字 | ✅ | ✅ |
| 格式化 | ❌ | ✅ |
| 程式碼高亮 | ❌ | ✅ |
| 列表 | ❌ | ✅ |
| 表格 | ❌ | ✅ |
| 引用 | ❌ | ✅ |
| 連結美化 | ✅ | ✅ |

---

## 🎓 進階應用

### 應用 1：技術文檔共享
使用 Markdown 格式化 API 文檔、函式說明等。

### 應用 2：程式碼審查
分享程式碼並使用引用功能討論特定行。

### 應用 3：會議協作
使用列表、表格組織會議內容。

### 應用 4：知識分享
使用標題、引用、程式碼區塊分享教學內容。

---

**💡 提示：** 這些功能讓聊天室不只是聊天工具，更是協作和知識分享的平台！
